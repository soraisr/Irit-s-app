<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מבדק קריאה - כיתה א'</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .word-card { font-size: clamp(5rem, 15vw, 10rem); line-height: 1.2; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const WORD_BANK = [
            { word: "בַּיִת", phonemes: "בית" }, { word: "כַּלְבָּה", phonemes: "כלבה" },
            { word: "פֶּרַח", phonemes: "פרח" }, { word: "שֻׁלְחָן", phonemes: "שולחן" },
            { word: "חֲלוֹם", phonemes: "חלום" }, { word: "עֲנָבִים", phonemes: "ענבים" },
            { word: "אֱמֶת", phonemes: "אמת" }, { word: "צָהֳרַיִם", phonemes: "צהריים" },
            { word: "מֶלֶךְ", phonemes: "מלך" }, { word: "עָנָן", phonemes: "ענן" },
            { word: "דַּף", phonemes: "דף" }, { word: "עֵץ", phonemes: "עץ" },
            { word: "מַיִם", phonemes: "מים" }, { word: "גְּדִי", phonemes: "גדי" },
            { word: "סוּס", phonemes: "סוס" }, { word: "תָּמָר", phonemes: "תמר" },
            { word: "טַל", phonemes: "טל" }, { word: "שִׂמְחָה", phonemes: "שמחה" },
            { word: "בְּרָכָה", phonemes: "ברכה" }, { word: "מַפְתֵּחַ", phonemes: "מפתח" },
            { word: "יָרֵחַ", phonemes: "ירח" }, { word: "כִּסֵּא", phonemes: "כיסא" },
            { word: "גָּמָל", phonemes: "גמל" }, { word: "וֶרֶד", phonemes: "ורד" },
            { word: "זֶבְּרָה", phonemes: "זברה" }, { word: "חֲנוּכָּה", phonemes: "חנוכה" },
            { word: "לוּלָב", phonemes: "לולב" }, { word: "סְבִיבוֹן", phonemes: "סביבון" },
            { word: "עוּגָה", phonemes: "עוגה" }, { word: "פִּיל", phonemes: "פיל" }
        ];

        function App() {
            const [step, setStep] = useState('start');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [results, setResults] = useState([]);
            const [isListening, setIsListening] = useState(false);
            const [transcript, setTranscript] = useState("");
            const [timerStart, setTimerStart] = useState(null);

            const recognitionRef = useRef(null);

            useEffect(() => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (SpeechRecognition) {
                    recognitionRef.current = new SpeechRecognition();
                    recognitionRef.current.lang = 'he-IL';
                    recognitionRef.current.continuous = false;
                    recognitionRef.current.onresult = (e) => setTranscript(e.results[0][0].transcript);
                    recognitionRef.current.onend = () => setIsListening(false);
                }
            }, []);

            const startTest = () => {
                setStep('test');
                setTimerStart(Date.now());
            };

            const toggleListening = () => {
                if (isListening) {
                    recognitionRef.current.stop();
                } else {
                    setTranscript("");
                    setIsListening(true);
                    recognitionRef.current.start();
                }
            };

            const handleNext = () => {
                const current = WORD_BANK[currentIndex];
                const isCorrect = transcript.trim() === current.phonemes || transcript.trim() === current.word;
                
                setResults([...results, { word: current.word, spoken: transcript, correct: isCorrect }]);
                
                if (currentIndex < WORD_BANK.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                    setTranscript("");
                } else {
                    setStep('summary');
                }
            };

            if (step === 'start') return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 text-center">
                    <h1 className="text-5xl font-bold text-blue-600 mb-6">שלום! מוכנים לקרוא?</h1>
                    <button onClick={startTest} className="bg-green-500 text-white text-3xl px-16 py-6 rounded-full shadow-2xl hover:bg-green-600">כן, בואו נתחיל!</button>
                </div>
            );

            if (step === 'summary') {
                const finalScore = Math.round((results.filter(r => r.correct).length / WORD_BANK.length) * 100);
                const totalSeconds = (Date.now() - timerStart) / 1000;
                const wpm = Math.round((WORD_BANK.length / totalSeconds) * 60);

                return (
                    <div className="p-6 max-w-2xl mx-auto">
                        <div className="bg-white rounded-3xl p-8 shadow-xl text-center mb-6">
                            <h2 className="text-3xl font-bold mb-4 text-blue-800">כל הכבוד! סיימת!</h2>
                            <div className="text-8xl font-black text-blue-600 mb-2">{finalScore}</div>
                            <p className="text-gray-500">ציון סופי</p>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-6 text-center">
                            <div className="bg-orange-100 p-4 rounded-2xl">
                                <div className="text-2xl font-bold">{wpm}</div>
                                <div className="text-sm">מילים בדקה</div>
                            </div>
                            <div className="bg-blue-100 p-4 rounded-2xl">
                                <div className="text-2xl font-bold">{Math.floor(totalSeconds)}</div>
                                <div className="text-sm">שניות בסה"כ</div>
                            </div>
                        </div>
                        <button onClick={() => window.location.reload()} className="w-full bg-gray-800 text-white py-4 rounded-xl text-xl font-bold">מבחן חדש</button>
                    </div>
                );
            }

            return (
                <div className="flex flex-col items-center justify-between min-h-screen p-8">
                    <div className="text-2xl font-bold text-gray-400">מילה {currentIndex + 1} מתוך {WORD_BANK.length}</div>
                    
                    <div className="text-center">
                        <div className="word-card font-bold text-black mb-10 select-none tracking-wider">
                            {WORD_BANK[currentIndex].word}
                        </div>
                        
                        <button onClick={toggleListening} className={`w-32 h-32 rounded-full flex items-center justify-center transition-all ${isListening ? 'bg-red-500 animate-pulse scale-110 shadow-red-200' : 'bg-blue-500 shadow-blue-200'} shadow-2xl`}>
                            <svg className="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 005.93 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-2.93v-2.07z"></path></svg>
                        </button>
                        <p className="mt-4 text-xl font-medium text-gray-600">{isListening ? "אני מקשיב..." : "לחצי על המיקרופון וקראי"}</p>
                        {transcript && <div className="mt-6 text-3xl text-blue-600 font-bold">שמעתי: "{transcript}"</div>}
                    </div>

                    <button onClick={handleNext} disabled={!transcript && !isListening} className={`w-full max-w-md py-6 rounded-3xl text-3xl font-bold transition-all ${!transcript ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-yellow-400 text-yellow-900 shadow-xl active:scale-95'}`}>
                        המשך למילה הבאה
                    </button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>